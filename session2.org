#+title: Session2
#+author: Atri Hegde

* Preface

Now that we know the basics our stack, let's start GETting and POSTing data from our database.

* Table of Contents :TOC:
- [[#preface][Preface]]
- [[#page-metadata][Page metadata]]
  - [[#default-metadata][Default metadata]]
- [[#creating-a-home-page][Creating a home page]]
  - [[#icons][Icons]]
  - [[#basic-styling][Basic styling.]]
- [[#feed-page][Feed page]]
  - [[#creating-the-page][Creating the page]]
  - [[#dummy-post][Dummy post]]
  - [[#shadcn-and-zod][shadcn and zod]]

* Page metadata

We want to be able to set custom page title and descriptions for all of our pages. For this first we set it in the root layout.

This means, if we don't specify a change, all our pages have that 'default' metadata.

#+begin_quote
Metadata is the hidden page data that the browser and bots on the internet use to get information on the website.
- Page title: displayed on the tab
- Page description: displayed on google search results, and in small text in url previews.
- keywords: Just "tags" used for SEO.
#+end_quote

** Default metadata

We can see that Next.js has already given us some default metadata in =app/layout.tsx=.

#+begin_src typescript
export const metadata: Metadata = {
  title: 'Create Next App',
  description: 'Generated by create next app',
};
#+end_src

You can put this snippet on any page, and it will have those fields updated for that page.

Lets modify this by adding a logo/image and some keywords.

First copy over the logo from [[./public/logo.png][the public directory]] and put it in your project's public directory.

#+begin_quote
Here we also add =metadataBase= property. This is because we are specifying which domain we are getting the images from.
#+end_quote

#+begin_src typescript
export const metadata: Metadata = {
  metadataBase: new URL('https://localhost:3000'),
  title: 'Instr',
  description: 'Twitter like application where you share posts.',
  keywords: 'Instr, Twitter, Instagram, Reddit',
  icons: '/logo.png',
  openGraph: {
    title: 'Instr',
    description: 'Twitter like application where you share posts.',
    images: '/logo.png',
  },
};
#+end_src

Now if you refresh the page, you should see the new icon on your tab from the =icons= property and when you share this url, the same logo next to it.

This piece of typescript code produced the following HTML.

#+begin_src html
<title>Instr</title>
<meta name="description" content="Twitter like application where you share posts."/>
<meta name="keywords" content="Instr, Twitter, Instagram, Reddit"/><meta property="og:title" content="Instr"/>
<meta property="og:description" content="Twitter like application where you share posts."/>
<meta property="og:image" content="http://localhost:3000/logo.png"/>
<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:title" content="Instr"/>
<meta name="twitter:description" content="Twitter like application where you share posts."/>
<meta name="twitter:image" content="http://localhost:3000/logo.png"/>
<link rel="icon" href="/favicon.ico" type="image/x-icon" sizes="16x16"/>
#+end_src

* Creating a home page

Let's get some of the prebuilt Next.js css.
Go delete everything except the tailwind imports in =globals.css= so it looks like this:

#+begin_src css
@tailwind base;
@tailwind components;
@tailwind utilities;
#+end_src

** Icons

We want to use some icons later on, so lets install an icons package. I like tabler-icons.

#+begin_src shell
yarn add @tabler/icons-react
#+end_src

You can find the list of icons on their [[https://tabler-icons.io][website]].

** Basic styling.

1. Please go to =layout.tsx= and have a look at the =className='s on the html, body and main tags.

#+begin_quote
Some basic styling such as page background, text colour, and some nice padding on our =<main>= to give make it look better (also slightly responsive?!).
#+end_quote

2. Place your =NavMenu= component above the main tag rather than inside of it.

#+begin_quote
Our navbar resizing and styling are different to the contents of the page. So we need to not have it inside of the main tag.
#+end_quote

3. Update your =Navbar= component with the updated code.

#+begin_quote
Make it an actual navbar. By default almost everything in tailwind is unstyled like links, buttons and headings.

Let's give our links underlines and buttons backgrounds from now on!
#+end_quote

4. Also update your =page.tsx= with the provided code.

#+begin_quote
Basic landing page. We also have some conditional rendering at the bottom.
#+end_quote

You now have a basic home screen.



* Feed page

** Creating the page

We want tit to be a guarded page.

First lets create the directory for this route =app/feed=.

Then let's create the file =page.tsx= inside this folder.

You should now be used to creating new components.

#+begin_src javascript
'use client';

const Feed = () => {
  return (
    <div>
      <p>Feed page</p>
    </div>
  );
};

export default Feed;
#+end_src

*** Guard the route.

We will look at a more efficient way of doing this next session.

But for now lets continue by using an if statement.

#+begin_src typescript
'use client';

import { useSession } from 'next-auth/react';
import { redirect } from 'next/navigation';

const Feed = () => {
  let { data: session } = useSession();

  if (session?.user) {
    return (
      // the page
    );
  } else {
      // else redirect
    redirect('/');
  }
};

export default Feed;
#+end_src

For now lets just render one static postcard.

*** Creating the Post model.

Let go add a new model in our schema called post.

#+begin_src prisma
model Post {
  id        String  @id @default(cuid())
  userId    String
  title     String
  published Boolean @default(true)
  views     Int     @default(0)
  likes     Int     @default(0)

  user User @relation(fields: [userId], references: [id])
  // If we want to delete all the users posts if they delete their account.
  // user User @relation(fields: [userId], references: [id], onDelete: Cascade)
}
#+end_src

Now we run =npx prisma migrate dev --name added-posts=.

#+begin_quote
Prisma is something that is running on the server side. This means that we cannot use prismaClient on the browser.
So we will be creating API's instead. This is one of the caveats of having a client side Session wrapper.
#+end_quote


** Dummy post

For now let us just create a dummy post using prisma studio (=npx prisma studio=).

Let's also make an api endpoint to get these posts.

#+begin_src typescript
import prisma from '@/lib/prisma';
import { NextResponse } from 'next/server';

export async function GET() {
  const posts = await prisma.post.findMany();
  return NextResponse.json(posts);
}
#+end_src

** shadcn and zod
*** shadcn

This is a UI library. We did not have a need for this, but as we introduce more and more components, this UI library that is very easily and extensively customisable will be very useful.

- [[https://ui.shadcn.com/docs/installation/next][Docs]].

Lets install it with:

#+begin_src shell
npx shadcn-ui@latest init
#+end_src

Lets also add the form and button components

#+begin_src shell
npx shadcn-ui@latest add button
npx shadcn-ui@latest add form
#+end_src

shadcn doesn't actually install any packages. Instead it creates files inside of =components/ui= that you can use straight away. Or you can modify them to your liking.

*** Zod

Zod is a validation library. It helps us validate the input and provide error messages.

Let's install it.

#+begin_src shell
yarn add zod
#+end_src

**** Using zod

Since we will want to validate the same types of objects in multiple locations, we define something called as a zod schema, which contains all the properties and their constraints.

Let's create the folder =lib/validations= for all these schema's. Let's also create a file in this folder =post.ts= which contains the schema for posts.

#+begin_src typescript
import { z } from 'zod';

export const postSchema = z.object({
  title: z.string(),
  description: z.string().max(250),
});
#+end_src
